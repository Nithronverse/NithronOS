#!/bin/sh
set -e

install -d -o root -g root -m 0755 /etc/caddy/conf.d
if [ ! -f /etc/caddy/Caddyfile ]; then
  printf ':80 {\n\timport /etc/caddy/conf.d/*.caddy\n}\n' > /etc/caddy/Caddyfile
elif ! grep -q 'conf\.d/\*\.caddy' /etc/caddy/Caddyfile; then
  printf '\nimport /etc/caddy/conf.d/*.caddy\n' >> /etc/caddy/Caddyfile
fi

# Reload Caddy if running
if command -v systemctl >/dev/null 2>&1 && systemctl is-active --quiet caddy; then
  systemctl reload caddy || systemctl restart caddy || true
fi

#DEBHELPER#

exit 0


