#!/usr/bin/make -f

export DH_VERBOSE=1
export DEB_BUILD_MAINT_OPTIONS=hardening=+all

%:
	dh $@

override_dh_auto_build:
	# Build backend binary from repo root path
	# packaging/deb/nosd -> repo root is ../../../
	cd ../../../backend/nosd && go mod tidy && CGO_ENABLED=0 go build -trimpath -ldflags "-s -w" -o ../../packaging/deb/nosd/deb-build/nosd .

override_dh_auto_install:
	install -D -m0755 deb-build/nosd debian/nosd/usr/bin/nosd

override_dh_dwz:
	@echo "skip dh_dwz for Go binary"
	@true

