#!/bin/bash
# Show first-boot banner with IP address

# Get IP address
get_ip() {
    # Try to get IP from default route
    ip=$(ip -4 route get 1.1.1.1 2>/dev/null | awk '/src/ {for(i=1;i<=NF;i++) if ($i=="src") {print $(i+1); exit}}')
    
    # Fallback to hostname -I
    if [ -z "$ip" ]; then
        ip=$(hostname -I | awk '{print $1}')
    fi
    
    # Default if still empty
    if [ -z "$ip" ]; then
        ip="your-server-ip"
    fi
    
    echo "$ip"
}

IP=$(get_ip)

# Display banner
echo ""
echo "================================================================================"
echo "NithronOS is ready!"
echo ""
echo "Access the web UI at: https://$IP/"
echo "(Certificate is self-signed on first boot)"
echo ""
echo "Use the one-time OTP from /tmp/nos-otp to complete setup."
echo "================================================================================"
echo ""
