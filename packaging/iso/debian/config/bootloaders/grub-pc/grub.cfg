# NithronOS GRUB Configuration for UEFI Boot

# Load modules for graphics and theming
insmod biosdisk
insmod part_msdos
insmod fat
insmod iso9660
insmod all_video
insmod gfxterm
insmod gfxmenu
insmod png
insmod jpeg

# Set graphics mode
set gfxmode=1024x768,800x600,auto
set gfxpayload=keep

# Enable graphics terminal
terminal_output gfxterm

# Load fonts
if loadfont /boot/grub/themes/nithron/DroidSans-32.pf2 ; then
  true
fi

if loadfont /boot/grub/unicode.pf2 ; then
  true
fi

# Set theme
set theme=/boot/grub/themes/nithron/theme.txt
export theme

# Menu configuration
set default=0
set timeout=10
set timeout_style=menu

# Menu entries

# Debian Installer Entry (Default)
menuentry "Install NithronOS" --class nithronos --class gnu-linux --class gnu --class os {
  echo "Starting NithronOS Installer..."
  linux  /install.amd/vmlinuz auto=true priority=critical preseed/file=/cdrom/preseed/nithronos.cfg DEBIAN_FRONTEND=newt net.ifnames=0 biosdevname=0 --- quiet
  initrd /install.amd/initrd.gz
}

# Debian Installer Expert Mode
menuentry "Install NithronOS (Expert Mode)" --class nithronos --class gnu-linux --class gnu --class os {
  echo "Starting NithronOS Installer in Expert Mode..."
  linux  /install.amd/vmlinuz priority=low DEBIAN_FRONTEND=newt net.ifnames=0 biosdevname=0 --- 
  initrd /install.amd/initrd.gz
}

# Debian Installer Rescue Mode
menuentry "Rescue Mode" --class nithronos --class gnu-linux --class gnu --class os {
  echo "Starting Rescue Mode..."
  linux  /install.amd/vmlinuz rescue/enable=true DEBIAN_FRONTEND=newt net.ifnames=0 biosdevname=0 --- quiet
  initrd /install.amd/initrd.gz
}

# Live System Entry
menuentry "NithronOS Live" --class nithronos --class gnu-linux --class gnu --class os {
  echo "Loading NithronOS Live System..."
  linux   /live/vmlinuz boot=live components quiet splash
  initrd  /live/initrd.img
}

# Live System Failsafe
menuentry "NithronOS Live (failsafe)" --class nithronos --class gnu-linux --class gnu --class os {
  echo "Loading NithronOS in failsafe mode..."
  linux   /live/vmlinuz boot=live components memtest noapic noapm nodma nomce nolapic nomodeset nosmp nosplash vga=normal
  initrd  /live/initrd.img
}

# Memory Test
menuentry "Memory Test (memtest86+)" --class memtest {
  echo "Loading Memory Test..."
  linux16 /live/memtest
}